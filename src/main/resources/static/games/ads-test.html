<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Ads & Rewards Test</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 960px; margin: 24px auto; padding: 0 12px; }
        h1 { margin-bottom: 12px; }
        .card { border:1px solid #ddd; border-radius:12px; padding:16px; margin:12px 0; }
        .row, .panel { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
        input, button, select { padding:10px 12px; border:1px solid #bbb; border-radius:10px; font-size:16px; }
        pre { background:#fafafa; border:1px solid #eee; padding:10px; border-radius:8px; overflow:auto; }
        .badge { background:#efefef; padding:6px 10px; border-radius:999px; }
    </style>
    <script defer src="/games/common.js"></script>
</head>
<body>
<h1>ğŸ’° Ads & Rewards Test</h1>

<!-- ë¡œê·¸ì¸ -->
<div class="card">
    <h3>1) ë¡œê·¸ì¸</h3>
    <div class="row">
        <label>ì•„ì´ë”” <input id="id" value="fhc"/></label>
        <label>ë¹„ë°€ë²ˆí˜¸ <input id="pw" value="fhc" type="password"/></label>
        <button id="btnLogin">ë¡œê·¸ì¸</button>
        <button id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
        <span id="loginStatus" class="badge"></span>
    </div>
</div>

<!-- ì •ì±… ì¡°íšŒ -->
<div class="card">
    <h3>2) ê´‘ê³  ì •ì±… ì¡°íšŒ</h3>
    <div class="panel">
        <button id="btnConfig">/ads/config ì¡°íšŒ</button>
        <span class="badge">ì˜¤ëŠ˜ ìˆ˜ë ¹: <span id="todayEarned">-</span></span>
        <span class="badge">ì”ì—¬: <span id="todayRemain">-</span></span>
        <span class="badge">êµ¬ë…ì: <span id="subscribed">-</span></span>
    </div>
    <pre id="configDump">{}</pre>
</div>

<!-- ë³´ìƒ ìˆ˜ë ¹ (ëª¨ì˜ ê´‘ê³  ì‹œì²­ ì™„ë£Œ) -->
<div class="card">
    <h3>3) ë³´ìƒ ìˆ˜ë ¹ (Mock)</h3>
    <div class="row">
        <label>ë³´ìƒ íƒ€ì…
            <select id="rewardType">
                <option value="HINT">HINT</option>
                <option value="EXTRA_TIME">EXTRA_TIME</option>
            </select>
        </label>
        <label>ìˆ˜ëŸ‰ <input id="amount" type="number" value="1" min="1" style="width:80px"/></label>
        <button id="btnClaim">/ads/rewards/claim</button>
        <span id="claimMsg" class="badge"></span>
    </div>
    <pre id="claimDump">{}</pre>
</div>

<!-- ì¸ë²¤í† ë¦¬ -->
<div class="card">
    <h3>4) ë‚´ ì¸ë²¤í† ë¦¬</h3>
    <div class="panel">
        <button id="btnInv">/ads/inventory/me</button>
        <span class="badge">HINT: <span id="hintBal">-</span></span>
        <span class="badge">EXTRA_TIME: <span id="extraBal">-</span></span>
    </div>
    <pre id="invDump">{}</pre>
</div>

<script>
    (() => {
      const $ = (id) => document.getElementById(id);
      function dump(el, obj){ el.textContent = JSON.stringify(obj, null, 2); }

      $('btnLogin').addEventListener('click', async () => {
        try {
          await API.login($('id').value, $('pw').value);
          $('loginStatus').textContent = 'ë¡œê·¸ì¸ ì„±ê³µ';
        } catch (e) {
          $('loginStatus').textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
        }
      });

      $('btnLogout').addEventListener('click', () => {
        API.clearToken();
        $('loginStatus').textContent = 'ë¡œê·¸ì•„ì›ƒ';
      });

      $('btnConfig').addEventListener('click', async () => {
        try {
          const cfg = await API.getAdsConfig();
          dump($('configDump'), cfg);
          $('todayEarned').textContent = String(cfg.todayEarned);
          $('todayRemain').textContent = String(cfg.todayRemain);
          $('subscribed').textContent = cfg.subscribed ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤';
        } catch (e) {
          dump($('configDump'), { error: e.message });
        }
      });

      $('btnClaim').addEventListener('click', async () => {
        try {
          const rewardType = $('rewardType').value;
          const amount = parseInt($('amount').value, 10) || 1;
          const r = await API.claimReward({ rewardType, amount });
          dump($('claimDump'), r);
          $('claimMsg').textContent = r.message || 'OK';
        } catch (e) {
          $('claimMsg').textContent = 'ì‹¤íŒ¨';
          dump($('claimDump'), { error: e.message });
        }
      });

      $('btnInv').addEventListener('click', async () => {
        try {
          const inv = await API.getMyInventory();
          dump($('invDump'), inv);
          $('hintBal').textContent = String(inv.hintTokens ?? 0);
          $('extraBal').textContent = String(inv.extraTimeTokens ?? 0);
        } catch (e) {
          dump($('invDump'), { error: e.message });
        }
      });
    })();
</script>
</body>
</html>